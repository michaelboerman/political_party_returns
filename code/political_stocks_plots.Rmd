---
title: "Returns for Stocks and Bonds under each Residential party"
output: html_notebook
---

This is a simple code for showing how stocks and bonds do when the presidential party is  Democratic or Republican. 

This code is 3 chunks:
1) Libraries
2) Read data
3) Plot! 

Chunks 2 and 3 are each one call. You can execute by using `ctrl + shift + enter` after clicking inside the plot. Run the entire file by using `ctrl + alt + r`. You will most likely need to install packages for the first chunk. 

Please recall that correlation != causation :)

### 1) Libraries
```{r, message = FALSE, warning = FALSE}
# The usuals
library(readxl)     # for reading the ecxel file
library(tidyverse)  # all inclusive
library(here)       # for relative file paths
library(scales)     # for easy conversion of decimal to % in plots
```

### 2) Read Data
The data was given to me by [Jacob Stephens](https://jacobcstephens.com/about/). He collected from ... . 
The spreadsheet can be [downloaded from his sharepoint.](https://gordonedu-my.sharepoint.com/:x:/g/personal/jacob_stephens_gordon_edu/EVx2b0Dwb3JJtNbFIklmS-gB_ZZAI9ei7jH0Bdvb6yWAEQ?e=eWGy8Y) *Unfortunately, it can't be read from a url due to the way sharepoint hosts files)*.

```{r}
# Load the data!
data <-
  read_xlsx(here("data_input/president-bond-stock-change-correlation.xlsx"),
    skip = 4
  ) %>%

  # excel saves spaces stupidly, so need this weird dot/space
  #  (don't ask how long i spent figuring this out)
  rename(
    stock_return = `S&P 500 Index `,
    year         = ` Year`,
    bond_return  = `100% Bonds `,
    party        = Party
  ) %>% 
  
  # insert a color for use in plotting later. Ignore case.
  # official colors of Repub and Dem parties
  mutate(political_colors = case_when(
    str_detect(party, "emocrat") ~ "#0015BC",
    str_detect(party, "epublic") ~ "#DE0100"
  ))
```


### 3) Plots!
This whole chunk is really one call. I use `pmap`, but since I only have two lists, could have gotten away with `map2`. I found this easier for maintaining a clean workspace, and the code is not so lengthy or computationally heavy that any time is lost. 
```{r}
# Plot!


# list the things I want to loop over
list(
    cols  = c("stock_return", "bond_return"),
    names = c("Stock", "Bond")
) %>% 

pmap(
  
  # and loop over them! 
  function(cols_to_plot, names_to_plot) {

    ## ---  parameter set up: --- ##
    
    # official colors of Repub and Dem parties
    # political_colors <- c("#0015BC", "#DE0100")

    # clean up the ggplot code later on by naming them now
  plot_title <- paste0("Annual ", names_to_plot, " Returns")
    
   data_source <- ifelse(
     names_to_plot == "Stock", 
     "S&P 500 returns", 
     "Bond returns (mix of U.S. Treasury bond durations and TIPS)"
   )

    plot_caption <- paste0(
      "Data are annual ",
      data_source,
      " from ",
      min(data$year),
      " to ",
      max(data$year)
    )
    
    ## --- Means --- ##

    # grab the means for each party for each asset class
    party_means <- data %>%
      select(party, stock_return, bond_return) %>%
      group_by(party) %>%
      summarize(
        stock_return = mean(stock_return),
        bond_return = mean(bond_return),
        .groups = "drop"
      ) %>%
      select(-party) %>%
      identity()
    
    ## --- Plots! --- ##

    ### Plot #1: Boxplot
    data %>%
      ggplot(aes(x = party, y = get(cols_to_plot), color = political_colors)) +
      scale_color_manual(values = political_colors) +
      geom_violin(
        alpha = 0.5,
        size  = 1,
      ) +
      ggbeeswarm::geom_quasirandom(
        # shape       = 1,
        size        = 3,
        width       = 0.34,
        dodge.width = .75, 
        alpha       = .75,
        show.legend = F
      ) +
      scale_y_continuous(
        labels = percent_format(accuracy = 2),
        limits = c(-0.4, 0.4) # to match density plot and fix axis
      ) +    
      theme_minimal() +
      labs(
        title = plot_title,
        caption = plot_caption
      ) +
      theme(
        legend.position = "none",
        axis.title = element_blank()
      ) +
      ggsave(filename = here(paste0("plots/box_", names_to_plot, ".png")))


    ### Plot #2: Density plot
    #    (2 = Repub, 1 = Dem)
    # This plot is somewhate misleading. There are only ~25 obs for
    #  each series, but the plot is basically a smooth histogram.
    
    # I think I may deprecate this plot in lieu of the violin plot above. 
    data %>%
      ggplot() +
      geom_density(aes(y = get(cols_to_plot), fill = party), alpha = 0.75) +
      scale_fill_manual(values = political_colors) +
      coord_flip() +
      geom_hline(yintercept = mean(pull(data[, cols_to_plot]))) +
      geom_hline(yintercept = pull(party_means[1, cols_to_plot]), color = political_colors[1]) +
      geom_hline(yintercept = pull(party_means[2, cols_to_plot]), color = political_colors[2]) +
      theme_minimal() +
      theme(
        legend.position = "top",
        legend.title = element_blank(),
        axis.title = element_blank(),
        axis.text.y = element_blank()
      ) +
      scale_y_continuous(
        labels = percent_format(accuracy = 2),
        # goes in ylim because of flipped coordinates.
        limits = c(-0.55, 0.55),
        expand = expansion(mult=0)
      ) +
      labs(
        title = plot_title,
        subtitle = "Vertical Bars are means",
        caption = plot_caption
      ) +
      ggsave(filename = here(paste0("plots/density_", names_to_plot, ".png")))
  }
)
```
